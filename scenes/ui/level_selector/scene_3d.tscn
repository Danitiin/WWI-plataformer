[gd_scene load_steps=26 format=3 uid="uid://cg721vsib53hd"]

[ext_resource type="PackedScene" uid="uid://bqnevuk8j6l8e" path="res://scenes/player/player_selector_3d.tscn" id="1_jaca1"]
[ext_resource type="PackedScene" uid="uid://batkcp513waqy" path="res://scenes/ui/level_selector/portal_base.tscn" id="1_portal"]
[ext_resource type="Script" uid="uid://iob8is6lwuw6" path="res://scenes/ui/level_selector/scene_3d.gd" id="1_qbslv"]
[ext_resource type="PackedScene" uid="uid://s4joiixvs22j" path="res://scenes/ui/pause_menu/pause_menu.tscn" id="4_21vc4"]
[ext_resource type="PackedScene" uid="uid://266awlb6oxi4" path="res://scenes/ui/level_selector/portal_sign.tscn" id="5_sign"]
[ext_resource type="AudioStream" uid="uid://d17cqtfxmfvxo" path="res://assets/audio/music/level_selector_music.mp3" id="6_te542"]

[sub_resource type="Environment" id="Environment_1"]
background_mode = 1
background_color = Color(0.5, 0.7, 1, 1)
ambient_light_source = 2
ambient_light_color = Color(1, 1, 1, 1)

[sub_resource type="CylinderMesh" id="CylinderMesh_1"]
top_radius = 2.67
bottom_radius = 3.33
height = 1.0
cap_bottom = false

[sub_resource type="Shader" id="Shader_Island"]
code = "shader_type spatial;

uniform vec4 grass_color : source_color = vec4(0.35, 0.65, 0.25, 1.0);
uniform vec4 sand_color : source_color = vec4(0.85, 0.75, 0.45, 1.0);
uniform float transition_height : hint_range(0.0, 1.0) = 0.4;
uniform float transition_smoothness : hint_range(0.0, 0.5) = 0.15;

void fragment() {
	float height_factor = UV.y;
	
	float blend = smoothstep(transition_height - transition_smoothness, transition_height + transition_smoothness, height_factor);
	
	vec3 final_color = mix(sand_color.rgb, grass_color.rgb, blend);
	
	ALBEDO = final_color;
	ROUGHNESS = 0.8;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_Island"]
render_priority = 0
shader = SubResource("Shader_Island")
shader_parameter/grass_color = Color(0.35, 0.65, 0.25, 1)
shader_parameter/sand_color = Color(0.85, 0.75, 0.45, 1)
shader_parameter/transition_height = 0.4
shader_parameter/transition_smoothness = 0.15

[sub_resource type="CylinderShape3D" id="CylinderShape3D_1"]
height = 1.0
radius = 3.33

[sub_resource type="BoxShape3D" id="BoxShape_North"]
size = Vector3(7.6, 3, 0.3)

[sub_resource type="BoxMesh" id="BoxMesh_jaca1"]
size = Vector3(7.6, 3, 0.3)

[sub_resource type="BoxShape3D" id="BoxShape_South"]
size = Vector3(7.6, 3, 0.3)

[sub_resource type="BoxMesh" id="BoxMesh_b1ubn"]
size = Vector3(7.6, 3, 0.3)

[sub_resource type="BoxShape3D" id="BoxShape_East"]
size = Vector3(0.3, 3.223755, 7.6)

[sub_resource type="BoxMesh" id="BoxMesh_qbslv"]
size = Vector3(0.3, 3, 7.6)

[sub_resource type="BoxShape3D" id="BoxShape_West"]
size = Vector3(0.3, 3.0864258, 7.6)

[sub_resource type="BoxMesh" id="BoxMesh_21vc4"]
size = Vector3(0.3, 3, 7.6)

[sub_resource type="PlaneMesh" id="PlaneMesh_1"]
size = Vector2(33.33, 33.33)
subdivide_width = 32
subdivide_depth = 32

[sub_resource type="Shader" id="Shader_1"]
code = "shader_type spatial;
render_mode cull_disabled, depth_draw_opaque;

uniform vec4 water_color_deep : source_color = vec4(0.08, 0.25, 0.55, 1.0);
uniform vec4 water_color_mid : source_color = vec4(0.12, 0.35, 0.65, 1.0);
uniform vec4 water_color_light : source_color = vec4(0.15, 0.42, 0.72, 1.0);
uniform float wave_speed = 0.3;
uniform float wave_amplitude = 0.12;
uniform float wave_frequency = 0.8;
uniform float color_blend_speed = 0.4;

void vertex() {
	float wave1 = sin(VERTEX.x * wave_frequency + TIME * wave_speed) * wave_amplitude;
	float wave2 = sin(VERTEX.z * wave_frequency * 0.7 + TIME * wave_speed * 0.8) * wave_amplitude * 0.5;
	float wave3 = cos(VERTEX.x * wave_frequency * 0.5 - VERTEX.z * wave_frequency * 0.5 + TIME * wave_speed * 0.6) * wave_amplitude * 0.3;
	VERTEX.y += wave1 + wave2 + wave3;
}

void fragment() {
	vec2 uv = UV * 2.0;

	float pattern1 = sin(uv.x * 3.0 + TIME * color_blend_speed) * 0.5 + 0.5;
	float pattern2 = sin(uv.y * 2.5 - TIME * color_blend_speed * 0.7) * 0.5 + 0.5;
	float pattern3 = cos((uv.x + uv.y) * 2.0 + TIME * color_blend_speed * 0.5) * 0.5 + 0.5;

	float blend1 = pattern1 * 0.4 + pattern2 * 0.3 + pattern3 * 0.3;
	float blend2 = pattern2 * 0.4 + pattern3 * 0.4 + pattern1 * 0.2;

	vec3 color_mix = mix(water_color_deep.rgb, water_color_mid.rgb, blend1);
	color_mix = mix(color_mix, water_color_light.rgb, blend2 * 0.5);

	ALBEDO = color_mix;
	ALPHA = 1.0;
	ROUGHNESS = 0.3;
	SPECULAR = 0.5;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_1"]
render_priority = -1
shader = SubResource("Shader_1")
shader_parameter/water_color_deep = Color(0.08, 0.25, 0.55, 1)
shader_parameter/water_color_mid = Color(0.12, 0.35, 0.65, 1)
shader_parameter/water_color_light = Color(0.15, 0.42, 0.72, 1)
shader_parameter/wave_speed = 0.3
shader_parameter/wave_amplitude = 0.12
shader_parameter/wave_frequency = 0.8
shader_parameter/color_blend_speed = 0.4

[sub_resource type="PlaneMesh" id="PlaneMesh_2"]
size = Vector2(33.33, 33.33)
subdivide_width = 24
subdivide_depth = 24

[sub_resource type="Shader" id="Shader_2"]
code = "shader_type spatial;
render_mode blend_add, depth_draw_opaque, cull_back, unshaded;

uniform vec4 foam_color_bright : source_color = vec4(0.7, 0.85, 0.95, 1.0);
uniform vec4 foam_color_soft : source_color = vec4(0.4, 0.6, 0.75, 1.0);
uniform float foam_speed = 0.15;
uniform float foam_scale = 4.0;
uniform float foam_intensity = 0.25;

void fragment() {
	vec2 uv = UV * foam_scale;
	
	vec2 uv1 = uv + vec2(TIME * foam_speed * 0.3, TIME * foam_speed * 0.2);
	vec2 uv2 = uv - vec2(TIME * foam_speed * 0.2, TIME * foam_speed * 0.4);
	vec2 uv3 = uv + vec2(TIME * foam_speed * 0.1, -TIME * foam_speed * 0.15);
	
	float foam_pattern1 = sin(uv1.x * 5.0) * cos(uv1.y * 4.0);
	float foam_pattern2 = sin(uv2.x * 3.5) * cos(uv2.y * 6.0);
	float foam_pattern3 = sin(uv3.x * 4.5) * sin(uv3.y * 3.5);
	
	float foam_noise = (foam_pattern1 + foam_pattern2 + foam_pattern3) * 0.33;
	foam_noise = smoothstep(0.3, 0.8, foam_noise);
	
	vec3 foam_color = mix(foam_color_soft.rgb, foam_color_bright.rgb, foam_noise);
	
	float final_alpha = foam_noise * foam_intensity;
	
	ALBEDO = foam_color;
	ALPHA = final_alpha;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2"]
render_priority = 1
shader = SubResource("Shader_2")
shader_parameter/foam_color_bright = Color(0.7, 0.85, 0.95, 1)
shader_parameter/foam_color_soft = Color(0.4, 0.6, 0.75, 1)
shader_parameter/foam_speed = 0.15
shader_parameter/foam_scale = 4.0
shader_parameter/foam_intensity = 0.25

[node name="LevelSelector" type="Node3D"]
script = ExtResource("1_qbslv")

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.7071068, 0.7071068, 0, -0.7071068, 0.7071068, 0, 5, 5.8739376)
fov = 50.0

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.866025, -0.433013, 0.25, 0, 0.5, 0.866025, -0.5, -0.75, 0.433013, 0, 3.33, 0)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_1")

[node name="PlayerStart" type="Marker3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.67, 2.67)

[node name="Island" type="StaticBody3D" parent="."]

[node name="MeshInstance3D" type="MeshInstance3D" parent="Island"]
mesh = SubResource("CylinderMesh_1")
surface_material_override/0 = SubResource("ShaderMaterial_Island")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Island"]
shape = SubResource("CylinderShape3D_1")

[node name="IslandBounds" type="StaticBody3D" parent="."]

[node name="Wall_North" type="CollisionShape3D" parent="IslandBounds"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.71191823, -2.6026256)
visible = false
shape = SubResource("BoxShape_North")

[node name="MeshInstance3D" type="MeshInstance3D" parent="IslandBounds/Wall_North"]
mesh = SubResource("BoxMesh_jaca1")

[node name="Wall_South" type="CollisionShape3D" parent="IslandBounds"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.7593303, 2.6698217)
visible = false
shape = SubResource("BoxShape_South")

[node name="MeshInstance3D" type="MeshInstance3D" parent="IslandBounds/Wall_South"]
mesh = SubResource("BoxMesh_b1ubn")

[node name="Wall_East" type="CollisionShape3D" parent="IslandBounds"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 2.7756078, -0.76939416, 0)
visible = false
shape = SubResource("BoxShape_East")

[node name="MeshInstance3D" type="MeshInstance3D" parent="IslandBounds/Wall_East"]
mesh = SubResource("BoxMesh_qbslv")

[node name="Wall_West" type="CollisionShape3D" parent="IslandBounds"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.7571561, -0.922678, 0)
visible = false
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="MeshInstance3D" parent="IslandBounds/Wall_West"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.37006032, 0)
mesh = SubResource("BoxMesh_21vc4")

[node name="Wall_West2" type="CollisionShape3D" parent="IslandBounds"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.335038, -0.9413099, 6.396243)
visible = false
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2"]
transform = Transform3D(0.99999905, 0, -0.0013788097, 0, 1, 0, 0.0013788097, 0, 0.99999905, 2.8765907, 0.5966693, -1.283659)
visible = false

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.30757856, 0.13763535, 0.5316348)
visible = false

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.30602074, -0.1477412, 0.32684326)
visible = false

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.649385, 0.5939039, -11.190498)
visible = false

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.284132, 0.0049940348, -0.15711641)

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.22272992, 0.5228554, -0.18451214)

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D2" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.3303633, 0.17898047, -0.45254517)
visible = false

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2"]
visible = false
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.3205197, 0.90140855, 0.08804846)

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D"]
visible = false
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.4088353, 0.109926105, 0.33514357)
visible = false

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.73627865, -1.0284632, -11.091791)

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
visible = false
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.3915131, 0.034046054, -0.47010183)

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
visible = false
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D2/MeshInstance3D/MeshInstance3D/MeshInstance3D/MeshInstance3D"]
shape = SubResource("BoxShape_West")

[node name="MeshInstance3D2" type="StaticBody3D" parent="IslandBounds/Wall_West2/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.30757856, -0.15047538, 0.5316348)

[node name="Visual" type="MeshInstance3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D2"]
mesh = SubResource("BoxMesh_21vc4")

[node name="CollisionShape3D" type="CollisionShape3D" parent="IslandBounds/Wall_West2/MeshInstance3D/MeshInstance3D2"]
shape = SubResource("BoxShape_West")

[node name="PlayerSelector3D" parent="." instance=ExtResource("1_jaca1")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.15774548, 0.84000003, 0.04422298)

[node name="Water" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.33, 0)
mesh = SubResource("PlaneMesh_1")
surface_material_override/0 = SubResource("ShaderMaterial_1")

[node name="WaterFoam" type="MeshInstance3D" parent="Water"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.02848053, 0.049998105, 0.0277915)
mesh = SubResource("PlaneMesh_2")
skeleton = NodePath("../..")
surface_material_override/0 = SubResource("ShaderMaterial_2")

[node name="Portales" type="Node3D" parent="."]

[node name="Portal1" parent="Portales" instance=ExtResource("1_portal")]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, -1.33, 0.83, 0.67)
level_id = 0

[node name="Sign" parent="Portales/Portal1" instance=ExtResource("5_sign")]
transform = Transform3D(1, 0, 0, 0, 0.70710677, 0.70710677, 0, -0.70710677, 0.70710677, 0, 1.5, 0)

[node name="Portal2" parent="Portales" instance=ExtResource("1_portal")]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 1.33, 0.83, 0.67)
level_id = 1

[node name="Sign" parent="Portales/Portal2" instance=ExtResource("5_sign")]
transform = Transform3D(1, 0, 0, 0, 0.70710677, 0.70710677, 0, -0.70710677, 0.70710677, 0, 1.5, 0)

[node name="Portal3" parent="Portales" instance=ExtResource("1_portal")]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, -0.06262565, 0.746285, -1.0649728)
level_id = 2

[node name="Sign" parent="Portales/Portal3" instance=ExtResource("5_sign")]
transform = Transform3D(1, 0, 0, 0, 0.70710677, 0.70710677, 0, -0.70710677, 0.70710677, 0, 1.5, 0)

[node name="PauseMenu" parent="." instance=ExtResource("4_21vc4")]
visible = false

[node name="AudioStreamPlayer3D" type="AudioStreamPlayer3D" parent="."]
stream = ExtResource("6_te542")
autoplay = true
